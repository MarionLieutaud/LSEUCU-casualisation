---
title: "Casualisation at LSE: macro and comparative analyses"
author: "LSE UCU anti-casualisation chairs"
date: "2023-03-02"
output: 
  bookdown::pdf_document2:
    toc: true
    fig_caption: true
    latex_engine: xelatex
editor_options: 
  chunk_output_type: inline
urlcolor: blue
---

```{r, include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)
```

```{r setup, include=FALSE}
library(tidyverse)
library(questionr)
library(stringr)
library(ggrepel)
library(ggtext)
library(forcats)
library(showtext)
library(hrbrthemes)
#hrbrthemes::import_roboto_condensed() # if need to download font
```

```{r graphicsthemes}
# theme for simple line plot
personal_theme_simple <- 
  theme_ipsum(base_size=9) +
  theme(plot.background = element_rect(fill = "white"),
        #panel.spacing.x = unit(0.5, "lines"),
        panel.grid.minor.y = element_blank(),
        axis.text.x = element_text(face = "bold",
                                   angle=30, 
                                   vjust=1, hjust= 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = ggtext::element_textbox_simple(size = 12),
        plot.subtitle = ggtext::element_textbox_simple(size = 9, face = "bold"),
        plot.caption.position = "plot",
        plot.caption = element_text(size = 7, face = "italic"),
        legend.position = "right",
        legend.text = element_text(size=10),
        legend.title = element_text(size=11))

# theme for proportionate change line plots
personal_theme_simple_propchange <- 
  theme_ipsum(base_size=9) +
  theme(plot.background = element_rect(fill = "white"),
        panel.spacing.x = unit(0.5, "lines"),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        axis.text.x = element_text(face = "bold", angle=30, vjust=1, hjust= 1),
        axis.title.x = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        plot.title = ggtext::element_textbox_simple(size = 12),
        plot.subtitle = ggtext::element_textbox_simple(size = 7, face = "bold"),
        plot.caption = element_text(size = 7, face = "italic"),
        legend.position = "right",
        legend.text = element_text(size=10),
        legend.title = element_text(size=11))

# theme for flipped barplot
personal_theme_flipped_barplot <- 
  theme_ipsum(base_size=9) +
  theme(plot.background = element_rect(fill = "white"),
        panel.spacing.x = unit(0.5, "lines"),
        panel.grid.minor.y = element_blank(),
        axis.text.y = element_text(size = 11, face = "bold"),
        axis.line.y.left = element_line(color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size = 12, face="bold", margin = margin(0,0,11,0)),
        plot.subtitle = element_text(size = 10, margin = margin(0,0,13,0)),
        plot.caption = element_text(size = 7, face = "italic"),
        legend.position = "bottom",
        legend.text = element_text(size=8),
        legend.title = element_blank())


# set extra colour as needed
BLUE <- "#076fa2"
```

\vspace{2cm}
All of the analyses presented here are based on publicly-available data published by the Higher Education Statistics Agency (HESA).
This data can be directly downloaded on the HESA website: \href{https://www.hesa.ac.uk/data-and-analysis}{https://www.hesa.ac.uk/data-and-analysis}.
```{r dataimport1}
# Data import and binding
# I downloaded the HESA data then manually removed the data description from the csv files and added the relevant academic year to each file name. 

# Start with HESA data on fixed term and permanent staff
# available at https://www.hesa.ac.uk/data-and-analysis/staff/employment-conditions
data_files <- list.files("~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/HESA data/Permanent and fixed term staff by HE provider/") # path to data folder
HESA <- grep("HESA-dt025-table-7", data_files, value=TRUE) # HESA tables on fixed-term / permanent academic staff

#import all data files on fixed-term / permanent contracts
for(i in 1:length(HESA)) {                                                  
  assign(paste0("hesa_wave", (i+2013),"-",(i+2014)),                        # Read and store data frames into files called "hesa-wave[academic year]"
         read.csv(paste0("~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/HESA data/Permanent and fixed term staff by HE provider/",
                           HESA[i])) %>%
           mutate(date = paste0((i+2013),"-",(i+2014))))                    # Add a date variable to each data frame to identify academic years.
}


list_hesa <- list(`hesa_wave2014-2015`,
                  `hesa_wave2015-2016`,
                  `hesa_wave2016-2017`,
                  `hesa_wave2017-2018`,
                  `hesa_wave2018-2019`,
                  `hesa_wave2019-2020`,
                  `hesa_wave2020-2021`,
                  `hesa_wave2021-2022`)

hs <- bind_rows(list_hesa)

rm(`hesa_wave2014-2015`,
   `hesa_wave2015-2016`,
   `hesa_wave2016-2017`,
   `hesa_wave2017-2018`,
   `hesa_wave2018-2019`,
   `hesa_wave2019-2020`,
   `hesa_wave2020-2021`,
   `hesa_wave2021-2022`,
   list_hesa)
```


```{r dataimport2}
# same procedure with data on student enrollment
data_files <- list.files("~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/HESA data/Total students number by HE provider/") # path to data folder
HESA_students <- grep("dt051-table-1", data_files, value=TRUE) # HESA tables on students enrollment by HE provider

#import all data files on students enrollment overall
for(i in 1:length(HESA_students)) {                                                  
  assign(paste0("hesa_wave", (i+2013),"-",(i+2014)),                        # Read and store data frames into files called "hesa-wave[academic year]"
         read.csv(paste0("~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/HESA data/Total students number by HE provider/",
                           HESA_students[i])) %>%
           mutate(across(!HE.provider,~str_remove(.x, ","))) %>%
           mutate(across(!HE.provider, ~as.numeric(.x))) %>%
           mutate(date = paste0((i+2013),"-",(i+2014))))                    # Add a date variable to each data frame to identify academic years.
}


list_hesa <- list(`hesa_wave2014-2015`,
                  `hesa_wave2015-2016`,
                  `hesa_wave2016-2017`,
                  `hesa_wave2017-2018`,
                  `hesa_wave2018-2019`,
                  `hesa_wave2019-2020`,
                  `hesa_wave2020-2021`,
                  `hesa_wave2021-2022`)

he <- bind_rows(list_hesa) %>%
  select(c(HE.provider, Total, date)) # drop breakdown by gender of students. Keep only totals

rm(`hesa_wave2014-2015`,
   `hesa_wave2015-2016`,
   `hesa_wave2016-2017`,
   `hesa_wave2017-2018`,
   `hesa_wave2018-2019`,
   `hesa_wave2019-2020`,
   `hesa_wave2020-2021`,
   `hesa_wave2021-2022`,
   list_hesa)


```

```{r dataimport3}
# Same procedure for data on international and EU students
data_files <- list.files("~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/HESA data/Non-UK and EU student number/") # path to data folder
HESA_international_students <- grep("dt051-table-28", data_files, value=TRUE) # HESA tables on EU and international students enrollment by HE provider

for(i in 1:length(HESA_international_students)) {                                                  
  assign(paste0("hesa_wave", (i+2013),"-",(i+2014)),                        
         read.csv(paste0("~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/HESA data/Non-UK and EU student number/",
                           HESA_international_students[i])) %>%
           rename(HE.provider = HE.Provider,
                  Total_nonuk = Total) %>%
           mutate(across(!HE.provider,~str_remove(.x, ","))) %>%
           mutate(across(!HE.provider, ~as.numeric(.x))) %>%
           mutate(date = paste0((i+2013),"-",(i+2014))))                    
}

list_hesa <- list(`hesa_wave2014-2015`,
                  `hesa_wave2015-2016`,
                  `hesa_wave2016-2017`,
                  `hesa_wave2017-2018`,
                  `hesa_wave2018-2019`,
                  `hesa_wave2019-2020`,
                  `hesa_wave2020-2021`,
                  `hesa_wave2021-2022`)

hi <- bind_rows(list_hesa) %>%
  select(HE.provider, Total.European.Union, Total_nonuk, date)

rm(`hesa_wave2014-2015`,
   `hesa_wave2015-2016`,
   `hesa_wave2016-2017`,
   `hesa_wave2017-2018`,
   `hesa_wave2018-2019`,
   `hesa_wave2019-2020`,
   `hesa_wave2020-2021`,
   `hesa_wave2021-2022`,
   list_hesa)
```

```{r joindata}
h <- hs %>%
  left_join(he, by = c("HE.provider", "date")) %>%
  left_join(hi, by = c("HE.provider", "date")) %>%
  relocate(date, .after = HE.provider)

# h = full dataframe combining staff and student data
```


```{r recoding}
# data recoding and calculated variables
h <- h %>%
  mutate(across(4:9,~str_remove(.x, ","))) %>% # remove comas
  mutate(across(4:9, ~as.numeric(.x))) # treat all number-based variables as numeric

h <- h %>%
  mutate(ratio_permanent = Open.ended.Permanent/Fixed.term,
         ratio_casual = Fixed.term/Open.ended.Permanent,
         prop_permanent = (Open.ended.Permanent/Total.academic.staff)*100,
         prop_casual = (Fixed.term/Total.academic.staff)*100,
         staffstudent_ratio = Total/Open.ended.Permanent,
         prop_non_uk = round((Total_nonuk/Total)*100, digits=0),
         prop_eu = round((Total.European.Union/Total)*100, digits=0))


hs_2022 <- h %>% # roundabout & ugly way to get latest measures of casualisation
  filter(date == "2021-2022") %>%
  rename(latest_prop_casual_2022 = prop_casual) %>%
  select(HE.provider, latest_prop_casual_2022) 

h <- h %>%
  left_join(hs_2022, by = "HE.provider") 

rm(hs_2022) # tidy it out
```

```{r subset}
# group of unis in top QS 2022 rankings
h_subset_uni <- h %>%
  filter(HE.provider %in% c("London School of Economics and Political Science",
                            "The University of Oxford",
                            "The University of Cambridge",
                            "Imperial College of Science, Technology and Medicine",
                            "University College London",
                            "The University of Edinburgh",
                            "King's College London",
                            "The University of Warwick",
                            "The University of Bristol",
                            "The University of Glasgow")) %>%
  mutate(HE.provider.short = case_match(HE.provider,
                                       "London School of Economics and Political Science" ~ "LSE",
                                       "The University of Oxford" ~ "Oxford",
                                       "The University of Cambridge" ~ "Cambridge",
                                       "Imperial College of Science, Technology and Medicine" ~ "Imperial",
                                       "University College London" ~ "UCL",
                                       "The University of Edinburgh" ~ "Edinburgh",
                                       "King's College London" ~ "KCL",
                                       "The University of Warwick" ~ "Warwick",
                                       "The University of Bristol" ~ "Bristol",
                                       "The University of Glasgow" ~ "Glasgow"))

h_subset_uni <- h_subset_uni %>%
  mutate(colour1 = ifelse(HE.provider == "London School of Economics and Political Science", "darkred", "darkgrey"),
         colour2 = ifelse(HE.provider == "London School of Economics and Political Science", "darkred", "black"))
```


# Number of permanent and fixed-term staff
```{r fixedandpermanentLSE, fig.showtext=TRUE}
h_lse <- h %>%
  filter(HE.provider %in% c("London School of Economics and Political Science")) 


h_lse_long <- pivot_longer(h_lse, cols = c(Open.ended.Permanent, Fixed.term),
                           names_to = "contract.type") %>%
  mutate(contract.type = case_match(contract.type, 
                                    "Fixed.term" ~ "fixed-term",
                                    "Open.ended.Permanent" ~ "permanent"))


p4 <- h_lse_long %>%
  ggplot(aes(x=date, y=value, group=contract.type)) +
  geom_point(aes(colour=contract.type)) +
  geom_line(aes(colour=contract.type)) +
  #scale_x_discrete(expand = expand_scale(mult = c(.05, .55))) +
  #scale_y_continuous(labels = scales::percent_format(scale = 1), breaks = seq(0,100,10), limits = c(0,100)) +
  scale_color_manual(values = c("darkred", "black"), name="Contract type: ") +
  labs(title = "Number of fixed-term and permanent academic staff at LSE",
       caption = "Source: HESA (annual data 2014-2022)") +
  personal_theme_simple

p4

#ggsave(p4, filename = "plot_HESA_nbstaff.png", width = 6.5, height = 4) # save plot
```



```{r permanentstaff, fig.showtext=TRUE, fig.dim= c(8,7)}
p1 <- h_subset_uni %>%
  ggplot(aes(x=date, y=prop_permanent, group=HE.provider, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(expand = expand_scale(mult = c(.05, .55))) +
  scale_y_continuous(labels = scales::percent_format(scale = 1), breaks = seq(0,100,10), limits = c(0,100)) +
  scale_colour_identity() +
  geom_text_repel(
    data = h_subset_uni %>% filter(date == "2021-2022"), 
    aes(label = HE.provider, group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3,
    segment.color = "grey93", direction = "y") +
  labs(title = "Proportion of permanent staff among academic staff",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis/staff/employment-conditions.\n Calculation of permanent (open-ended contracts) staff as proportion or all academic staff.\n The nine comparators chosen are the universities above LSE in the 2022 QS Rankings (Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL)\nand immediatley below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple
  
#p1

#ggsave(p1, filename = "plot_HESA_prop_permanent.png", width = 9, height = 7.5) # save plot
```

# Proportion of casual staff
```{r casualstaff, fig.showtext=TRUE, fig.dim= c(8,7)}
p2 <- h_subset_uni %>%
  ggplot(aes(x=date, y=prop_casual, group=HE.provider.short, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(expand = expand_scale(mult = c(.05, .35))) +
  scale_y_continuous(labels = scales::percent_format(scale = 1), breaks = seq(0,100,10), limits = c(0,75)) +
  scale_colour_identity() +
  geom_text_repel(
    data = h_subset_uni %>% filter(date == "2021-2022"), 
    aes(label = paste0(HE.provider.short, ": ", round(latest_prop_casual_2022, digits=0), "%"), group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3.5,
    segment.color = "grey93", direction = "y") +
  labs(title = "Proportion of fixed-term staff among academic staff",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis/staff/employment-conditions\nCalculation of fixed-term staff as a proportion or all academic staff.\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings (Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL)\nand immediatley below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple
  
p2

#ggsave(p2, filename = "plot_HESA_prop_casual.png", width = 10, height = 7.5) # save plot
```


# Changes in permanent staff numbers
```{r permanentfall,fig.showtext=TRUE, fig.dim= c(8,7)}
tab_wide <- h_subset_uni %>%
  group_by(HE.provider.short, date, Open.ended.Permanent) %>%
  summarise(n = n()) %>%
  pivot_wider(names_from = "date", values_from = "Open.ended.Permanent") %>%
  select(-n)

tab_wide2 <- tab_wide %>%
  mutate(diff_2015 = `2015-2016` - `2014-2015`,
         diff_2016 = `2016-2017` - `2015-2016`,
         diff_2017 = `2017-2018` - `2016-2017`,
         diff_2018 = `2018-2019` - `2017-2018`,
         diff_2019 = `2019-2020` - `2018-2019`,
         diff_2020 = `2020-2021` - `2019-2020`,
         diff_2021 = `2021-2022` - `2020-2021`,
         diff_overall = `2021-2022` - `2014-2015`)

tab_wide2 <- tab_wide2 %>%
  mutate(change_permanent2014 = 0,
         change_permanent2015 = (diff_2015/`2014-2015`)*100,
         change_permanent2016 = (diff_2016/`2015-2016`)*100,
         change_permanent2017 = (diff_2017/`2016-2017`)*100,
         change_permanent2018 = (diff_2018/`2017-2018`)*100,
         change_permanent2019 = (diff_2019/`2018-2019`)*100,
         change_permanent2020 = (diff_2020/`2019-2020`)*100,
         change_permanent2021 = (diff_2021/`2020-2021`)*100,
         change_permanentoverall = ((`2021-2022` - `2014-2015`) / `2014-2015`)*100) 

tab_permanentchange_print <- tab_wide2 %>%
  select(HE.provider.short, matches("^change_permanent")) %>%
  mutate(across(matches("change"), ~ round(.x, digits = 0)))

names(tab_permanentchange_print) <- c(names(tab_wide), "Overall")
#write_csv(tab_permanentchange_print, "tab_permanentchange.csv") # save table of percentage changes

tab_wide_cumul <- tab_wide2 %>%
  mutate(cum_change_permanent2014 = 0,
         cum_change_permanent2015 = change_permanent2015,
         cum_change_permanent2016 = cum_change_permanent2015 + change_permanent2016,
         cum_change_permanent2017 = cum_change_permanent2016 + change_permanent2017,
         cum_change_permanent2018 = cum_change_permanent2017 + change_permanent2018,
         cum_change_permanent2019 = cum_change_permanent2018 + change_permanent2019,
         cum_change_permanent2020 = cum_change_permanent2019 + change_permanent2020,
         cum_change_permanent2021 = cum_change_permanent2020 + change_permanent2021) %>%
  select(HE.provider.short, matches("cum_change"), matches("overall"))

tab_long_cumul <- tab_wide_cumul %>% 
  select(HE.provider.short, matches("change"), matches("overall")) %>%
  pivot_longer(cols = !c(HE.provider.short, diff_overall, change_permanentoverall),
    names_to = c("typechange", "year"),
    names_pattern = "(cum_change_permanent)(.*)$"
  ) %>%
  filter(!is.na(typechange)) %>%
  mutate(colour1 = ifelse(HE.provider.short == "LSE", "darkred", "darkgrey"),
         colour2 = ifelse(HE.provider.short == "LSE", "darkred", "black"),
         change_permanentoverall2 = ifelse(change_permanentoverall > 0, paste0("+", as.character(round(change_permanentoverall), digits=0)),
                                          as.character(round(change_permanentoverall), digits=0)),
         HE.overall = paste0(HE.provider.short,": ", change_permanentoverall2, "%"),
         HE.overall = ifelse(HE.provider.short == "LSE", paste0(HE.overall, "\nrelative to 2014 - 2015"), HE.overall))

p3 <- tab_long_cumul %>%
  ggplot(aes(x=year, y=value, group=HE.provider.short, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(labels = levels(as.factor(hs$date)),
                   expand = expand_scale(mult = c(.05, .45))) +
  scale_y_continuous() +
  scale_colour_identity() +
  geom_text_repel(
    data = tab_long_cumul %>% filter(year == "2021"), 
    aes(label = HE.overall, group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3.5,
    segment.color = "grey93", direction = "y") +
  geom_richtext(aes(x = "2014", y = 10, family = "Arial Narrow",
                    label = "  baseline<br>= 0"),
                size = 3, fill = NA, label.color = NA, color = "darkgrey") +
  labs(title = "Proportionate changes in number of permanent academic staff",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis/staff/employment-conditions \nCalculation of yearly change in permanent staff as a percentage of the number of permanent staff the year before.\nChange starts from 0, corresponding to the 2014-2015 numbers of permanent staff, set as baseline.\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings\n(Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL) nand immediatley below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple_propchange
  
p3

#ggsave(p3, filename = "plot_HESA_cumul_permanent_change.png", width = 6, height = 5) # save plot
```

```{r plotstudentnbchange, fig.showtext=TRUE, fig.dim= c(8,7)}
tab_wide <- h_subset_uni %>%
  group_by(HE.provider.short, date, Total) %>%
  summarise(n = n()) %>%
  pivot_wider(names_from = "date", values_from = "Total") %>%
  select(-n)

tab_wide2 <- tab_wide %>%
  mutate(diff_2015 = `2015-2016` - `2014-2015`,
         diff_2016 = `2016-2017` - `2015-2016`,
         diff_2017 = `2017-2018` - `2016-2017`,
         diff_2018 = `2018-2019` - `2017-2018`,
         diff_2019 = `2019-2020` - `2018-2019`,
         diff_2020 = `2020-2021` - `2019-2020`,
         diff_2021 = `2021-2022` - `2020-2021`,
         diff_overall = `2021-2022` - `2014-2015`)

tab_wide2 <- tab_wide2 %>%
  mutate(change_studentnb2014 = 0,
         change_studentnb2015 = (diff_2015/`2014-2015`)*100,
         change_studentnb2016 = (diff_2016/`2015-2016`)*100,
         change_studentnb2017 = (diff_2017/`2016-2017`)*100,
         change_studentnb2018 = (diff_2018/`2017-2018`)*100,
         change_studentnb2019 = (diff_2019/`2018-2019`)*100,
         change_studentnb2020 = (diff_2020/`2019-2020`)*100,
         change_studentnb2021 = (diff_2021/`2020-2021`)*100,
         change_studentnboverall = ((`2021-2022` - `2014-2015`) / `2014-2015`)*100) 

tab_change_studentnb_print <- tab_wide2 %>%
  select(HE.provider.short, matches("^change_studentnb")) %>%
  mutate(across(matches("change"), ~ round(.x, digits = 0)))

names(tab_change_studentnb_print) <- c(names(tab_wide), "Overall")
#write_csv(tab_change_studentnb_print, "tab_change_studentnb.csv") # save table of percentage changes

tab_wide_cumul <- tab_wide2 %>%
  mutate(cum_change_studentnb2014 = 0,
         cum_change_studentnb2015 = change_studentnb2015,
         cum_change_studentnb2016 = cum_change_studentnb2015 + change_studentnb2016,
         cum_change_studentnb2017 = cum_change_studentnb2016 + change_studentnb2017,
         cum_change_studentnb2018 = cum_change_studentnb2017 + change_studentnb2018,
         cum_change_studentnb2019 = cum_change_studentnb2018 + change_studentnb2019,
         cum_change_studentnb2020 = cum_change_studentnb2019 + change_studentnb2020,
         cum_change_studentnb2021 = cum_change_studentnb2020 + change_studentnb2021) %>%
  select(HE.provider.short, matches("cum_change"), matches("overall"))

tab_long_cumul <- tab_wide_cumul %>% 
  select(HE.provider.short, matches("change"), matches("overall")) %>%
  pivot_longer(cols = !c(HE.provider.short, diff_overall, change_studentnboverall),
    names_to = c("typechange", "year"),
    names_pattern = "(cum_change_studentnb)(.*)$"
  ) %>%
  filter(!is.na(typechange)) %>%
  mutate(colour1 = ifelse(HE.provider.short == "LSE", "darkred", "darkgrey"),
         colour2 = ifelse(HE.provider.short == "LSE", "darkred", "black"),
         change_studentnboverall2 = ifelse(change_studentnboverall > 0, paste0("+", as.character(round(change_studentnboverall), digits=0)),
                                          as.character(round(change_studentnboverall), digits=0)),
         HE.overall = paste0(HE.provider.short,": ", change_studentnboverall2, "%"),
         HE.overall = ifelse(HE.provider.short == "LSE", paste0(HE.overall, "\nrelative to 2014 - 2015"), HE.overall))

p5 <- tab_long_cumul %>%
  ggplot(aes(x=year, y=value, group=HE.provider.short, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(labels = levels(as.factor(hs$date)),
                   expand = expand_scale(mult = c(.05, .45))) +
  scale_y_continuous(name = "Proportionate yearly changes (cumulative)") +
  scale_colour_identity() +
  geom_text_repel(
    data = tab_long_cumul %>% filter(year == "2021"), 
    aes(label = HE.overall, group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3.5,
    segment.color = "grey93", direction = "y") +
  geom_richtext(aes(x = "2014", y = 10, family = "Arial Narrow",
                    label = "  baseline<br>= 0"),
                size = 3, fill = NA, label.color = NA, color = "darkgrey") +
  labs(title = "Proportionate changes in student numbers since 2014-2015",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis/students\nCalculation of yearly change in student enrollment as a percentage of the number of students enrolled the year before.\nChange starts from 0, corresponding to the 2014-2015 student numbers, set as baseline.\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings\n(Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL) nand immediatley below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple_propchange
  
p5

#ggsave(p5, filename = "plot_HESA_studentsnb_change.png", width = 6, height = 5) # save plot
```


# Student-staff ratio (permanent academic staff members)
```{r plotstaffstudentratio, fig.showtext=TRUE, fig.dim= c(8,7)}
p6 <- h_subset_uni %>%
  ggplot(aes(x=date, y=staffstudent_ratio, group=HE.provider.short, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(labels = levels(as.factor(hs$date)),
                   expand = expand_scale(mult = c(.05, .40))) +
  scale_y_continuous(breaks = seq(2,18, 2)) +
  scale_colour_identity() +
  geom_text_repel(
    data = h_subset_uni %>% filter(date == "2021-2022"), 
    aes(label = ifelse(HE.provider.short == "LSE", paste0(HE.provider.short,": ",staffstudent_ratio, " students per\npermanent staff member"),
                       HE.provider.short), 
        group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3.5,
    segment.color = "grey93", direction = "y") +
  labs(title = "Student to permanent staff ratio",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis.\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings\n(Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL) and the three immediately below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple
  
p6

#ggsave(p6, filename = "plot_HESA_studentstaff_ratio.png", width = 6, height = 5) # save plot
```

# Proportion international students
```{r, fig.showtext=TRUE, fig.dim= c(8,7)}
p7 <- h_subset_uni %>%
  ggplot(aes(x=date, y=prop_non_uk, group=HE.provider.short, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(labels = levels(as.factor(hs$date)),
                   expand = expand_scale(mult = c(.05, .4))) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  scale_colour_identity() +
  geom_text_repel(
    data = h_subset_uni %>% filter(date == "2021-2022"), 
    aes(label = ifelse(HE.provider.short == "LSE", paste0(HE.provider.short,": ",prop_non_uk, "%\ninternational students"),
                       paste0(HE.provider.short, ": ",prop_non_uk, "%")),
        group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3.5,
    segment.color = "grey93", direction = "y") +
  labs(title = "Proportion of international students",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis.\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings\n(Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL) and the three immediately below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple
  
p7

#ggsave(p7, filename = "plot_HESA_nonUKstudent_ratio.png", width = 6, height = 5) # save plot
```


# Proportion EU and non-EU international students

```{r barplotInternationalStudents, fig.showtext=TRUE, fig.dim= c(8,6)}
tab_int_long <- h_subset_uni %>% 
  filter(date == "2021-2022") %>%
  select(HE.provider.short, prop_non_uk, prop_eu) %>%
  mutate(prop_nonuk_noneu = prop_non_uk - prop_eu) %>%
  pivot_longer(cols = !c(HE.provider.short, prop_non_uk),
    names_to = c("prop")
  )


p9 <- ggplot(tab_int_long, aes(x=fct_reorder(HE.provider.short, value), y=value, fill = fct_rev(prop))) +
  geom_col(stat = "stacked", width = 0.6) +
  coord_flip() +
  scale_fill_manual(labels = c("Other international students", "EU students"),
                      values = c(BLUE, "lightblue")) +
  scale_y_continuous(breaks = seq(0, 70, by = 10),
                     expand = expand_scale(mult = c(0, .10)),
                     position = "right") +
  labs(title = "% of international students (EU + non-EU)",
       subtitle = "out of all enrolled students in 2021-2022",
       fill = NULL,
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis.\n The percentage in white is the total proportion of non-UK students (EU + non-EU).\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings\n(Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL) and the three immediately below it (Warwick, Bristol, Glasgow).") +
  guides(fill = guide_legend(reverse = TRUE)) +
  personal_theme_flipped_barplot

# add labels outside bars
p9 <- p9 + geom_text(
    data = tab_int_long %>% filter(prop == "prop_nonuk_noneu"),
    aes(y=prop_non_uk, x = HE.provider.short, label = paste0(prop_non_uk, "%")),
    #vjust = 1,
    nudge_y = 2,
    colour = BLUE,
    family = "Arial Narrow",
    fontface = "bold",
    size = 4)

# add labels inside bars
p9 <- p9 + geom_text(
    data = tab_int_long %>% filter(prop == "prop_eu"),
    aes(y=value, x = HE.provider.short, label = paste0(value, "%")),
    #vjust = 1,
    nudge_y = -2,
    colour = BLUE,
    family = "Arial Narrow",
    fontface = "bold",
    size = 3)

p9

#ggsave(p9, filename = "plot_HESA_nonUKstudent_barplot.png", width = 6, height = 5) # save plot

```

# EU students
```{r eustudents, fig.showtext=TRUE, fig.dim = c(8,7)}
p8 <- h_subset_uni %>%
  ggplot(aes(x=date, y=prop_eu, group=HE.provider.short, colour = colour1)) +
  geom_point() +
  geom_line() +
  scale_x_discrete(labels = levels(as.factor(hs$date)),
                   expand = expand_scale(mult = c(.05, .30))) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  scale_colour_identity() +
  geom_text_repel(
    data = h_subset_uni %>% filter(date == "2021-2022"), 
    aes(label = ifelse(HE.provider.short == "LSE", paste0(HE.provider.short,": ",prop_eu, "%\nEU students"),
                       paste0(HE.provider.short, ": ",prop_eu, "%")),
        group = colour2, colour = colour2),
    nudge_x = 0.2, hjust = 0, family = "Arial Narrow", fontface = "bold", size = 3.5,
    segment.color = "grey93", direction = "y") +
  labs(title = "Proportion of EU students",
       caption = "Source: HESA (annual data 2014-2022) https://www.hesa.ac.uk/data-and-analysis.\nThe nine comparators chosen are the universities above LSE in the 2022 QS Rankings\n(Oxford, Cambridge, Imperial, UCL, Edinburgh, KCL) and the three immediately below it (Warwick, Bristol, Glasgow).") +
  personal_theme_simple
  
p8

#ggsave(p8, filename = "plot_HESA_EUstudent_ratio.png", width = 6, height = 5) # save plot
```

# Money matters

**Increase in tuition fees** between 2014-2015 and 2021-2022: 

Taught postgraduate degrees
- + £250/year for home students
- + £6,038/year for international students (averaged across programs)

Undergraduate degrees:
- calculate diff for home students
- calculate diff for international students (mean across programs)

In 2021-2022, there was roughly the same numbers of EU students enrolled at LSE as in 2014-2015 (1970 and 1905, respectively). 
But in 2021-2022, every newly-arrived EU students is now paying international fees.
If all EU students in 2021-2022 pay international fees (around £23,330/year for undegraduates), then that represent £28.8 millions extra for LSE, relative to 2014-2015 when the same students would all have been paying home fees (£9000/year) 

28.8 millions extra just from EU students switching to International fees.
 

# LSE fellow and postdoc survey : survey description, results not yet disclosed

The 2022-2023 Postdoc and Fellow survey, conducted jointly by the LSE Fellows network and the UCU anti-casualisation officers, targeted all categories of post-doctoral fellows (LSE Fellows, Teaching Fellows, Research Fellows, Research Officers). The survey yielded 171 responses, 158 of which are fixed-term but not hourly positions. This includes 99 LSE Fellows, and 49 Research Fellows and Research Officers. Based on HR breakdown of Fellows (including LSE Fellows, Teaching Fellows, Research Fellows, Policy Fellows, Professorial Fellows and Research Officer), we can estimate that the survey participation rate was at around 70% for LSE Fellows and 65% for fixed-term (not hourly) staff overall. The survey represented all departments and institutes except for the departments of Finance and Accounting.

Results from the 2022-2023 Postdoc and Fellow Survey are not presented here as the school has not yet had a chance to respond to them. We will share some of the results and analysis along with the school's response at a later point.


```{r, include = FALSE}
# These are analyses from the fellow survey which cannot be included yet. 
# But since we will want to include them in a later, full report, I have included them here in this fashion, so as to make it available to us but invisible to readers of the report.

#Most respondents (65%) are funded internally by LSE, as LSE Fellows or Teaching Fellows. **45% of participants have been hired on one-year contracts or shorter** (the percentage of short contracts is the same for externally or internally funded postdoctoral positions). 

#Heavy teaching and marking loads for teaching Fellows as well as LSE Fellows. 40% of full-time LSE Fellows teach more than 101 hours, and 16% teach more than 125 hours per academic year (not including office hours). Half of LSE Fellows (48%) report that they spent upward of 70% of their working time on teaching and administrative duties. Accordingly, two out of three LSE Fellows estimate that their current teaching and administrative load has left them too little time to carry out their research. 

# Fellows' working conditions and precarity
```


```{r, fig.align='center', out.width="70%", include = FALSE}
knitr::include_graphics('~/Dropbox (Personal)/UCU & Fellows Network/Casualisation data/Q_future_plot.png')
```

```{r, include = FALSE}
# Insecurity
#Mental heath issues are endemic among respondents, as is overwork (working regularly in the evenings, at the weekend, on vacation) and anxiety linked to professional insecurity.
#There is a difference of close to 10 percentage points between those on short contracts (52% constant anxiety) and those on longer contracts (44% constant anxiety). The overwhelming majority of survey respondents **(92%) are affirmative that they will not get a permanent position at LSE**: 69% think it ‘very unlikely’ and a further 23% deem it ‘unlikely’. 
```

